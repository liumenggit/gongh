<template>
    <tm-app ref="app" :bg-img="useSettingStore().bgimg">
        <tm-sheet :margin="[0,20,0,20]" :padding="[0,0]" transprent>
            <tm-cell showAvatar transprent :round="3" :avatarSize="80" :margin="[24,0]"
                     :label="useUserInfo.phone as string" labelColor="grey-2">
                <template v-slot:avatar>
                    <tm-image :src="useUserInfo.avatar" :width="100" :height="100" :round="20"></tm-image>
                </template>
                <template v-slot:title>
                    <view class="flex-row flex-row-center-start nowrap">
                        <tm-text :label="useUserInfo.nickname"></tm-text>
                        <!--                        <tm-tag :label="useUserInfo.auth.card?.cardId?'已实名':'未实名'" text :shadow="0"-->
                        <!--                                icon="td-safetycertificate-f" color="grey-4" size="xs"></tm-tag>-->
                    </view>
                </template>
                <template v-slot:right>
                    <view class="flex-row flex-row-center-center flex-wrap" @click="scanCode">
                        <tm-icon name="tmicon-scan" color="white" :font-size="40" class="fulled"></tm-icon>
                        <tm-text label="扫一扫" color="white" :font-size="18"/>
                    </view>
                </template>
            </tm-cell>
        </tm-sheet>
        <tm-alert :shadow="2" :content="alertContent" :height="80"></tm-alert>
        <tm-card title="我的卡包" :round="3">
            <template v-slot:content>
                <tm-grid :width="638" :col="3">
                    <tm-grid-item :height="120" url="/pages/my/card-pack?type=2">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <view class="flex-row flex-row-center-between">
                            <tm-text _class="pt-10" :font-size="22" label="已核销"></tm-text>
                            <tm-text _class="pt-10 pl-5" :font-size="22" :label="`${useUserInfo.writeOffCouponCount}张`"
                                     color="decolor"></tm-text>
                        </view>
                    </tm-grid-item>
                    <tm-grid-item :height="120">
                        <tm-icon name="td-box" :font-size="60"></tm-icon>
                        <view class="flex-row flex-row-center-between">
                            <tm-text _class="pt-10" :font-size="22" label="已优惠"></tm-text>
                            <tm-text _class="pt-10 pl-5" :font-size="22" :label="`${useUserInfo.discountAmount || 0}元`"
                                     color="decolor"></tm-text>
                        </view>
                    </tm-grid-item>
                    <tm-grid-item :height="120" url="/pages/my/card-pack?type=1">
                        <tm-icon name="td-clipboard" :font-size="60"></tm-icon>
                        <view class="flex-row flex-row-center-between">
                            <tm-text _class="pt-10" :font-size="22" label="可使用"></tm-text>
                            <tm-text _class="pt-10 pl-5" :font-size="22" :label="`${useUserInfo.couponCount}张`"
                                     color="decolor"></tm-text>
                        </view>
                    </tm-grid-item>
                </tm-grid>
            </template>
        </tm-card>
        <tm-card title="我的积分" :round="3">
            <template v-slot:content>
                <tm-grid :width="638" :col="4">
                    <tm-grid-item :height="120">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="抽奖礼品"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="签到得积分"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="积分明细"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="积分礼品"></tm-text>
                    </tm-grid-item>
                </tm-grid>
            </template>
        </tm-card>
        <tm-card title="常用工具" :round="3">
            <template v-slot:content>
                <tm-grid :width="638" :col="4">
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="劳动就业"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="意见反馈"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/my/message')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="消息通知"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/my/revise')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="个人设置"></tm-text>
                    </tm-grid-item>
                </tm-grid>
            </template>
        </tm-card>
        <tm-card title="特色功能" :round="3">
            <template v-slot:content>
                <tm-grid :width="638" :col="4">
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="在线缴费"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="户外驿站"></tm-text>
                    </tm-grid-item>
                </tm-grid>
            </template>
        </tm-card>
        <tm-card title="管理员" :round="3">
            <template v-slot:content>
                <tm-grid :width="638" :col="4">
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="店员添加"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="核销记录"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="店员列表"></tm-text>
                    </tm-grid-item>
                    <tm-grid-item :height="120" @click="useRouter().go('/pages/index/index')">
                        <tm-icon name="td-archive" :font-size="60"></tm-icon>
                        <tm-text _class="pt-10" :font-size="22" label="兑换记录"></tm-text>
                    </tm-grid-item>
                </tm-grid>
            </template>
        </tm-card>
        <tm-image :margin="[32,0,32,0]"
                  src="http://w720190822.oss-cn-qingdao.aliyuncs.com/ghphpt/images/83e1fffdd3f8c36b8e2e5ba81b16ed9e.png"
                  :width="686" :round="3"/>
        <tm-text :label="`版本号：${getVersiond()}`" _class="fulled text-align-center my-20"/>
    </tm-app>
</template>
<script lang="ts" setup>
import {
    onShow,
    onLoad,
} from '@dcloudio/uni-app';
import {useUserStore} from '@/state/modules/user';
import {useRouter} from '@/hooks/router';
import {ref} from 'vue';
import {getVersiond} from '@/utils/env';
import {scanCode} from '@/tmui/tool/function/util';
import {useSettingStore} from '@/state/modules/setting';
import {useAuthStore} from '@/state/modules/auth';

const useUserInfo = useUserStore().$state;
const alertContent = ref([
    {
        icon: 'tmicon-alert',
        content: '这是一条新闻这是一条新闻这是一条新闻这是一条新闻这是一条新闻这是一条新闻22这是一条新闻这是一条新闻这是一条新闻'
    }
]);
onLoad(() => {
    console.log('useAuthStore().isLogin', useAuthStore().isLogin);
});
onShow(() => {
    useUserStore().updateUserInfo();
});

</script>
